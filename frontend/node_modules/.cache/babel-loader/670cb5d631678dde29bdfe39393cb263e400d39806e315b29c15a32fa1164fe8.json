{"ast":null,"code":"import React,{useState,useEffect}from'react';import{supabase}from'./supabaseClient';import{jsx as _jsx,jsxs as _jsxs}from\"react/jsx-runtime\";function App(){const[roomName,setRoomName]=useState('');const[userName,setUserName]=useState('');const[isInRoom,setIsInRoom]=useState(false);const[newRoomName,setNewRoomName]=useState('');const[newUserName,setNewUserName]=useState('');const[songs,setSongs]=useState([]);const[newSong,setNewSong]=useState('');const[suggestions,setSuggestions]=useState([]);useEffect(()=>{if(!isInRoom)return;loadSongs();const channel=supabase.channel('public:songs').on('postgres_changes',{event:'*',schema:'public',table:'songs',filter:`room_id=eq.${roomName}`},payload=>{loadSongs();}).subscribe();return()=>{supabase.removeChannel(channel);};},[isInRoom,roomName]);const loadSongs=async()=>{if(!roomName)return;const{data,error}=await supabase.from('songs').select('*').eq('room_id',roomName).order('votes',{ascending:false});if(!error){setSongs(data);}};const fetchSuggestions=async query=>{if(!query)return setSuggestions([]);try{var _data$tracks;const response=await fetch(`http://localhost:3001/search?q=${encodeURIComponent(query)}`);const data=await response.json();if((_data$tracks=data.tracks)!==null&&_data$tracks!==void 0&&_data$tracks.items){setSuggestions(data.tracks.items);}else{setSuggestions([]);}}catch(error){console.error('Error fetching suggestions:',error);setSuggestions([]);}};const handleSuggestionClick=async track=>{var _track$artists;const title=`${track.name} — ${(_track$artists=track.artists)===null||_track$artists===void 0?void 0:_track$artists.map(a=>a.name).join(', ')}`;const{error}=await supabase.from('songs').insert({title,room_id:roomName,votes:0});if(!error){setNewSong('');setSuggestions([]);loadSongs();}};const handleJoinRoom=()=>{if(!newRoomName||!newUserName)return;setRoomName(newRoomName);setUserName(newUserName);setIsInRoom(true);};const handleVote=async(songId,delta)=>{const{data,error:fetchError}=await supabase.from('songs').select('votes').eq('id',songId).single();if(fetchError)return;const currentVotes=data.votes||0;const{error:updateError}=await supabase.from('songs').update({votes:currentVotes+delta}).eq('id',songId);if(!updateError){loadSongs();}};if(!isInRoom){return/*#__PURE__*/_jsxs(\"div\",{style:{padding:40},children:[/*#__PURE__*/_jsx(\"h1\",{children:\"\\uD83C\\uDFB6 Hang The DJ\"}),/*#__PURE__*/_jsx(\"input\",{type:\"text\",placeholder:\"Room name\",value:newRoomName,onChange:e=>setNewRoomName(e.target.value),style:{marginBottom:10,display:'block'}}),/*#__PURE__*/_jsx(\"input\",{type:\"text\",placeholder:\"Your name\",value:newUserName,onChange:e=>setNewUserName(e.target.value),style:{marginBottom:10,display:'block'}}),/*#__PURE__*/_jsx(\"button\",{onClick:handleJoinRoom,children:\"Join\"})]});}return/*#__PURE__*/_jsxs(\"div\",{style:{padding:40},children:[/*#__PURE__*/_jsxs(\"h2\",{children:[\"\\uD83C\\uDF89 You are in room \\\"\",roomName,\"\\\"\"]}),/*#__PURE__*/_jsxs(\"p\",{children:[\"Your nickname: \",userName]}),/*#__PURE__*/_jsx(\"h3\",{children:\"Search for a song:\"}),/*#__PURE__*/_jsx(\"input\",{type:\"text\",value:newSong,onChange:e=>{setNewSong(e.target.value);fetchSuggestions(e.target.value);},placeholder:\"Type a song title\",style:{width:'100%',marginBottom:10}}),/*#__PURE__*/_jsx(\"ul\",{style:{listStyle:'none',paddingLeft:0},children:suggestions.map(track=>/*#__PURE__*/_jsxs(\"li\",{onClick:()=>handleSuggestionClick(track),style:{cursor:'pointer',padding:'8px',border:'1px solid #ccc',borderRadius:4,marginBottom:5,background:'#f9f9f9'},children:[track.name,\" \\u2014 \",track.artists.map(a=>a.name).join(', ')]},track.id))}),/*#__PURE__*/_jsx(\"h3\",{children:\"\\uD83C\\uDFB5 Song queue:\"}),/*#__PURE__*/_jsxs(\"p\",{children:[\"Total songs: \",songs.length]}),/*#__PURE__*/_jsx(\"ul\",{children:songs.map(song=>/*#__PURE__*/_jsxs(\"li\",{children:[song.title,\" \\u2014 \",song.votes,\" votes\",/*#__PURE__*/_jsx(\"button\",{onClick:()=>handleVote(song.id,1),children:\"\\uD83D\\uDC4D\"}),/*#__PURE__*/_jsx(\"button\",{onClick:()=>handleVote(song.id,-1),children:\"\\uD83D\\uDC4E\"})]},song.id))})]});}export default App;","map":{"version":3,"names":["React","useState","useEffect","supabase","jsx","_jsx","jsxs","_jsxs","App","roomName","setRoomName","userName","setUserName","isInRoom","setIsInRoom","newRoomName","setNewRoomName","newUserName","setNewUserName","songs","setSongs","newSong","setNewSong","suggestions","setSuggestions","loadSongs","channel","on","event","schema","table","filter","payload","subscribe","removeChannel","data","error","from","select","eq","order","ascending","fetchSuggestions","query","_data$tracks","response","fetch","encodeURIComponent","json","tracks","items","console","handleSuggestionClick","track","_track$artists","title","name","artists","map","a","join","insert","room_id","votes","handleJoinRoom","handleVote","songId","delta","fetchError","single","currentVotes","updateError","update","style","padding","children","type","placeholder","value","onChange","e","target","marginBottom","display","onClick","width","listStyle","paddingLeft","cursor","border","borderRadius","background","id","length","song"],"sources":["/Users/barboracabalkova/htdj/frontend/src/App.js"],"sourcesContent":["import React, { useState, useEffect } from 'react'\nimport { supabase } from './supabaseClient'\n\nfunction App() {\n  const [roomName, setRoomName] = useState('')\n  const [userName, setUserName] = useState('')\n  const [isInRoom, setIsInRoom] = useState(false)\n  const [newRoomName, setNewRoomName] = useState('')\n  const [newUserName, setNewUserName] = useState('')\n  const [songs, setSongs] = useState([])\n  const [newSong, setNewSong] = useState('')\n  const [suggestions, setSuggestions] = useState([])\n\n  useEffect(() => {\n    if (!isInRoom) return\n\n    loadSongs()\n\n    const channel = supabase\n      .channel('public:songs')\n      .on(\n        'postgres_changes',\n        { event: '*', schema: 'public', table: 'songs', filter: `room_id=eq.${roomName}` },\n        (payload) => {\n          loadSongs()\n        }\n      )\n      .subscribe()\n\n    return () => {\n      supabase.removeChannel(channel)\n    }\n  }, [isInRoom, roomName])\n\n  const loadSongs = async () => {\n    if (!roomName) return\n\n    const { data, error } = await supabase\n      .from('songs')\n      .select('*')\n      .eq('room_id', roomName)\n      .order('votes', { ascending: false })\n\n    if (!error) {\n      setSongs(data)\n    }\n  }\n\n  const fetchSuggestions = async (query) => {\n    if (!query) return setSuggestions([])\n\n    try {\n      const response = await fetch(`http://localhost:3001/search?q=${encodeURIComponent(query)}`)\n      const data = await response.json()\n      if (data.tracks?.items) {\n        setSuggestions(data.tracks.items)\n      } else {\n        setSuggestions([])\n      }\n    } catch (error) {\n      console.error('Error fetching suggestions:', error)\n      setSuggestions([])\n    }\n  }\n\n  const handleSuggestionClick = async (track) => {\n    const title = `${track.name} — ${track.artists?.map((a) => a.name).join(', ')}`\n    const { error } = await supabase.from('songs').insert({\n      title,\n      room_id: roomName,\n      votes: 0,\n    })\n    if (!error) {\n      setNewSong('')\n      setSuggestions([])\n      loadSongs()\n    }\n  }\n\n  const handleJoinRoom = () => {\n    if (!newRoomName || !newUserName) return\n    setRoomName(newRoomName)\n    setUserName(newUserName)\n    setIsInRoom(true)\n  }\n\n  const handleVote = async (songId, delta) => {\n    const { data, error: fetchError } = await supabase\n      .from('songs')\n      .select('votes')\n      .eq('id', songId)\n      .single()\n\n    if (fetchError) return\n\n    const currentVotes = data.votes || 0\n\n    const { error: updateError } = await supabase\n      .from('songs')\n      .update({ votes: currentVotes + delta })\n      .eq('id', songId)\n\n    if (!updateError) {\n      loadSongs()\n    }\n  }\n\n  if (!isInRoom) {\n    return (\n      <div style={{ padding: 40 }}>\n        <h1>🎶 Hang The DJ</h1>\n        <input\n          type=\"text\"\n          placeholder=\"Room name\"\n          value={newRoomName}\n          onChange={(e) => setNewRoomName(e.target.value)}\n          style={{ marginBottom: 10, display: 'block' }}\n        />\n        <input\n          type=\"text\"\n          placeholder=\"Your name\"\n          value={newUserName}\n          onChange={(e) => setNewUserName(e.target.value)}\n          style={{ marginBottom: 10, display: 'block' }}\n        />\n        <button onClick={handleJoinRoom}>Join</button>\n      </div>\n    )\n  }\n\n  return (\n    <div style={{ padding: 40 }}>\n      <h2>🎉 You are in room \"{roomName}\"</h2>\n      <p>Your nickname: {userName}</p>\n\n      <h3>Search for a song:</h3>\n      <input\n        type=\"text\"\n        value={newSong}\n        onChange={(e) => {\n          setNewSong(e.target.value)\n          fetchSuggestions(e.target.value)\n        }}\n        placeholder=\"Type a song title\"\n        style={{ width: '100%', marginBottom: 10 }}\n      />\n\n      <ul style={{ listStyle: 'none', paddingLeft: 0 }}>\n        {suggestions.map((track) => (\n          <li\n            key={track.id}\n            onClick={() => handleSuggestionClick(track)}\n            style={{\n              cursor: 'pointer',\n              padding: '8px',\n              border: '1px solid #ccc',\n              borderRadius: 4,\n              marginBottom: 5,\n              background: '#f9f9f9',\n            }}\n          >\n            {track.name} — {track.artists.map((a) => a.name).join(', ')}\n          </li>\n        ))}\n      </ul>\n\n      <h3>🎵 Song queue:</h3>\n      <p>Total songs: {songs.length}</p>\n      <ul>\n        {songs.map((song) => (\n          <li key={song.id}>\n            {song.title} — {song.votes} votes\n            <button onClick={() => handleVote(song.id, 1)}>👍</button>\n            <button onClick={() => handleVote(song.id, -1)}>👎</button>\n          </li>\n        ))}\n      </ul>\n    </div>\n  )\n}\n\nexport default App\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}